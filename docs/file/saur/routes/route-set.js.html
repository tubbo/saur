<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../">
  <title data-ice="title">saur/routes/route-set.js | saur</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
<a style="position:relative; top:3px;" href="https://github.com/tubbo/saur"><img width="20px" src="./image/github.png"></a></header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/saur/application.js~Application.html">Application</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/saur/controller.js~Controller.html">Controller</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/saur/mailer.js~Mailer.html">Mailer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/saur/model.js~Model.html">Model</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/saur/routes.js~Routes.html">Routes</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/saur/task.js~Task.html">Task</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/saur/view.js~View.html">View</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-validate">validate</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-validates">validates</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-task">task</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-describe">describe</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#application">application</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/saur/application/adapter.js~Adapter.html">Adapter</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/saur/application/cache.js~Cache.html">Cache</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/saur/application/cache.js~MemoryCache.html">MemoryCache</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/saur/application/cache.js~RedisCache.html">RedisCache</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/saur/application/database.js~Database.html">Database</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/saur/application/database.js~MysqlAdapter.html">MysqlAdapter</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/saur/application/database.js~PostgresAdapter.html">PostgresAdapter</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#application-initializers">application/initializers</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Assets">Assets</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-EnvironmentConfig">EnvironmentConfig</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-ForceSSL">ForceSSL</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Logging">Logging</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-ServeStaticFiles">ServeStaticFiles</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#application-middleware">application/middleware</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-AuthenticityToken">AuthenticityToken</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-CompileAssets">CompileAssets</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-ContentSecurityPolicy">ContentSecurityPolicy</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-CORS">CORS</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-logger">logger</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-MethodOverride">MethodOverride</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-MissingRoute">MissingRoute</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-OakCache">OakCache</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-SSLRedirect">SSLRedirect</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-StaticFiles">StaticFiles</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-timing">timing</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#cli">cli</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Generate">Generate</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Migrate">Migrate</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-New">New</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Run">Run</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#cli-generate">cli/generate</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-controller">controller</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-mailer">mailer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-migration">migration</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-model">model</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-GenerateTemplate">GenerateTemplate</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Test">Test</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-GenerateView">GenerateView</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#errors">errors</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/saur/errors/missing-route.js~MissingRouteError.html">MissingRouteError</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#model">model</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/saur/model/errors.js~Errors.html">Errors</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/saur/model/migration.js~Migration.html">Migration</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/saur/model/relation.js~Relation.html">Relation</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/saur/model/validations.js~GenericValidation.html">GenericValidation</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/saur/model/validations.js~Presence.html">Presence</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/saur/model/validations.js~Validation.html">Validation</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#routes">routes</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/saur/routes/helpers.js~RouteHelpers.html">RouteHelpers</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/saur/routes/route-set.js~RouteSet.html">RouteSet</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/saur/routes/route.js~Route.html">Route</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#view">view</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/saur/view/template.js~Template.html">Template</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">saur/routes/route-set.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">import Route from &quot;./route.js&quot;;
/**
 * RouteSet defines the routing DSL used by the top-level application
 * router. It uses `Oak.Router` under the hood, but pre-fills
 * information based on the current context and whether you&apos;ve selected
 * a controller. Controllers are selected by providing a `resources()`
 * route, and base paths can be selected by themselves by providing a
 * `namespace()`.
 */
export default class RouteSet {
  constructor(router, options = {}) {
    this.router = router;
    this.controller = options.controller;
    this.base = options.base;
    this.routes = [];
    this.namespaces = [];
  }

  /**
   * Call the function provided and pass in all of the routing methods
   * contextualized to this particular set. This enables &quot;relative&quot;
   * routing where calling e.g. `get()` within a `namespace()`
   * will nest the path of the GET request into the namespace itself.
   */
  draw(routing) {
    const get = this.get.bind(this);
    const post = this.post.bind(this);
    const put = this.put.bind(this);
    const patch = this.patch.bind(this);
    const del = this.delete.bind(this);
    const resources = this.resources.bind(this);
    const namespace = this.namespace.bind(this);
    const root = this.root.bind(this);
    const use = this.use.bind(this);

    if (this.base) {
      routing({
        use,
        get,
        post,
        put,
        patch,
        delete: del,
        resources,
        namespace,
      });
    } else {
      routing({
        use,
        get,
        post,
        put,
        patch,
        delete: del,
        resources,
        namespace,
        root,
      });
    }
  }

  add({ as, path, controller, action }) {
    this.routes.push(new Route({ as, path, controller, action }));
  }

  /**
   * Route a GET request to the given path. You can also specify a
   * `controller` and `action`, but these options will default to the
   * top-level controller (if you&apos;re in a `resources()` block) and the
   * name of the path, respectively.
   */
  get(path, options = {}) {
    const action = options.action || path;
    const as = options.as || action;
    const controller = options.controller || this.controller;
    path = this.base ? `${this.base}/${path}` : path;

    this.add({ as, path, controller, action });
    this.router.get(path, controller.perform(action));
  }

  use(middleware) {
    this.router.use(this.base, middleware);
  }

  /**
   * Route a POST request to the given path. You can also specify a
   * `controller` and `action`, but these options will default to the
   * top-level controller (if you&apos;re in a `resources()` block) and the
   * name of the path, respectively.
   */

  post(path, options = {}) {
    const action = options.action || path;
    const as = options.as || action;
    const controller = options.controller || this.controller;
    path = this.base ? `${this.base}/${path}` : path;

    this.add({ as, path, controller, action });
    this.router.post(path, controller.perform(action));
  }

  /**
   * Route a PUT request to the given path. You can also specify a
   * `controller` and `action`, but these options will default to the
   * top-level controller (if you&apos;re in a `resources()` block) and the
   * name of the path, respectively.
   */
  put(path, options = {}) {
    const action = options.action || path;
    const as = options.as || action;
    const controller = options.controller || this.controller;
    path = this.base ? `${this.base}/${path}` : path;

    this.add({ as, path, controller, action });
    this.router.put(path, controller.perform(action));
  }

  /**
   * Route a PATCH request to the given path. You can also specify a
   * `controller` and `action`, but these options will default to the
   * top-level controller (if you&apos;re in a `resources()` block) and the
   * name of the path, respectively.
   */
  patch(path, options = {}) {
    const action = options.action || path;
    const as = options.as || action;
    const controller = options.controller || this.controller;
    path = this.base ? `${this.base}/${path}` : path;

    this.add({ as, path, controller, action });
    this.router.patch(path, controller.perform(action));
  }

  /**
   * Route a del request to the given path. You can also specify a
   * `controller` and `action`, but these options will default to the
   * top-level controller (if you&apos;re in a `resources()` block) and the
   * name of the path, respectively.
   */
  delete(path, options = {}) {
    const action = options.action || path;
    const as = options.as || action;
    const controller = options.controller || this.controller;
    path = this.base ? `${this.base}/${path}` : path;

    this.add({ as, path, controller, action });
    this.router.delete(path, controller.perform(action));
  }

  /**
   * Define a RouteSet that is nested within this one.
   */
  namespace(path, routes) {
    const controller = this.controller;
    const base = `${this.base}/${path}`;
    const set = new RouteSet(this.router, { controller, base });
    path = this.base ? `${this.base}/${path}` : path;

    this.namespaces.push({ path, controller, base });
    set.draw(routes);
  }

  /**
   * Define the index route to the application. This is always a GET
   * request.
   */
  root(action, controller) {
    this.add({ path: &quot;/&quot;, as: &quot;root&quot;, controller, action });
    this.get(&quot;/&quot;, { controller, action });
  }

  /**
   * Define a RESTful resource, which contains all
   * create/read/update/destroy actions as well as new/edit pages. You
   * can optionally also pass a function in which provides two route
   * sets of nested resources for the &quot;collection&quot; and &quot;member&quot; routes.
   */
  resources(path, controller, nested) {
    this.get(path, { controller, action: &quot;index&quot; });
    this.post(path, { controller, action: &quot;create&quot; });
    this.get(`${path}/new`, { controller, action: &quot;new&quot; });
    this.get(`${path}/:id`, { controller, action: &quot;show&quot; });
    this.get(`${path}/:id/edit`, { controller, action: &quot;edit&quot; });
    this.put(`${path}/:id`, { controller, action: &quot;update&quot; });
    this.patch(`${path}/:id`, { controller, action: &quot;update&quot; });
    this.delete(`${path}/:id`, { controller, action: &quot;destroy&quot; });

    if (nested) {
      const cs = new RouteSet(this.router, { controller, base: path });
      const ms = new RouteSet(this.router, { controller, base: `${path}/:id` });
      const collection = cs.draw.bind(cs);
      const member = ms.draw.bind(ms);

      nested({ collection, member });
    }
  }

  /**
   * Mount an application or Oak middleware at the given path.
   */
  mount(path, app) {
    path = this.base ? `${this.base}/${path}` : path;

    if (app.routes) {
      this.namespace(path, ({ use }) =&gt; use(app.routes.all));
    } else {
      this.router.use(path, app);
    }
  }
}
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
